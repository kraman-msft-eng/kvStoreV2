<!DOCTYPE html>
<html>
<head>
    <title>KVStore Benchmark - Lookup & Read Latency</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a2e; color: #eee; }
        h1 { text-align: center; color: #00d4ff; }
        h2 { color: #00d4ff; margin-top: 40px; }
        .chart-container { width: 90%; max-width: 1000px; margin: 20px auto; background: #16213e; padding: 20px; border-radius: 10px; }
        .chart-row { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
        .chart-box { flex: 1; min-width: 450px; max-width: 600px; }
        table { margin: 20px auto; border-collapse: collapse; background: #16213e; }
        th, td { padding: 8px 15px; border: 1px solid #444; text-align: right; }
        th { background: #0f3460; color: #00d4ff; }
        tr:nth-child(even) { background: #1a1a3e; }
    </style>
</head>
<body>
    <h1>KVStore Benchmark Results</h1>
    <h2>Latency vs Token Throughput</h2>
    
    <div class="chart-container">
        <h3 style="text-align:center; color:#ff6b6b;">Lookup Latency</h3>
        <canvas id="lookupChart"></canvas>
    </div>
    
    <div class="chart-container">
        <h3 style="text-align:center; color:#4ecdc4;">Read Latency</h3>
        <canvas id="readChart"></canvas>
    </div>
    
    <div class="chart-container">
        <h3 style="text-align:center; color:#ffe66d;">Throughput</h3>
        <canvas id="throughputChart"></canvas>
    </div>
    
    <h2>Raw Data</h2>
    <table>
        <tr>
            <th>Concurrency</th>
            <th>TPS</th>
            <th>K Tokens/s</th>
            <th>Lookup p50</th>
            <th>Lookup p90</th>
            <th>Lookup p99</th>
            <th>Lookup p100</th>
            <th>Read p50</th>
            <th>Read p90</th>
            <th>Read p99</th>
            <th>Read p100</th>
        </tr>
        <tr>
            <td>1</td>
            <td>3.5</td>
            <td>4.1</td>
            <td>5.72ms</td>
            <td>8.76ms</td>
            <td>11.51ms</td>
            <td>64.50ms</td>
            <td>19.67ms</td>
            <td>21.57ms</td>
            <td>24.43ms</td>
            <td>27.78ms</td>
        </tr>
        <tr>
            <td>2</td>
            <td>7.0</td>
            <td>8.0</td>
            <td>5.43ms</td>
            <td>8.44ms</td>
            <td>11.14ms</td>
            <td>39.27ms</td>
            <td>19.76ms</td>
            <td>21.95ms</td>
            <td>24.77ms</td>
            <td>33.03ms</td>
        </tr>
        <tr>
            <td>4</td>
            <td>14.1</td>
            <td>16.3</td>
            <td>5.21ms</td>
            <td>8.02ms</td>
            <td>10.76ms</td>
            <td>43.61ms</td>
            <td>20.22ms</td>
            <td>22.56ms</td>
            <td>33.38ms</td>
            <td>50.35ms</td>
        </tr>
        <tr>
            <td>6</td>
            <td>20.9</td>
            <td>24.1</td>
            <td>5.06ms</td>
            <td>7.86ms</td>
            <td>11.21ms</td>
            <td>33.78ms</td>
            <td>20.64ms</td>
            <td>23.21ms</td>
            <td>36.25ms</td>
            <td>63.64ms</td>
        </tr>
        <tr>
            <td>8</td>
            <td>28.1</td>
            <td>32.4</td>
            <td>5.06ms</td>
            <td>7.66ms</td>
            <td>10.77ms</td>
            <td>38.16ms</td>
            <td>20.85ms</td>
            <td>23.74ms</td>
            <td>33.66ms</td>
            <td>85.02ms</td>
        </tr>
        <tr>
            <td>16</td>
            <td>44.1</td>
            <td>50.8</td>
            <td>5.00ms</td>
            <td>7.50ms</td>
            <td>12.81ms</td>
            <td>63.43ms</td>
            <td>22.71ms</td>
            <td>27.84ms</td>
            <td>55.52ms</td>
            <td>124.12ms</td>
        </tr>
        <tr>
            <td>32</td>
            <td>66.0</td>
            <td>76.0</td>
            <td>4.95ms</td>
            <td>6.69ms</td>
            <td>11.54ms</td>
            <td>101.35ms</td>
            <td>27.13ms</td>
            <td>42.12ms</td>
            <td>88.24ms</td>
            <td>202.56ms</td>
        </tr>
        <tr>
            <td>64</td>
            <td>81.2</td>
            <td>93.5</td>
            <td>5.56ms</td>
            <td>8.95ms</td>
            <td>21.00ms</td>
            <td>100.50ms</td>
            <td>40.28ms</td>
            <td>77.29ms</td>
            <td>138.14ms</td>
            <td>205.24ms</td>
        </tr>
        <tr>
            <td>80</td>
            <td>79.8</td>
            <td>91.9</td>
            <td>6.03ms</td>
            <td>13.01ms</td>
            <td>36.24ms</td>
            <td>98.73ms</td>
            <td>59.21ms</td>
            <td>121.87ms</td>
            <td>173.29ms</td>
            <td>211.64ms</td>
        </tr>
    </table>
    
    <script>
        const labels = ['1c', '2c', '4c', '6c', '8c', '16c', '32c', '64c', '80c'];
        const tokensK = [4.0896, 8.04096, 16.25472, 24.122880000000002, 32.40576, 50.83776, 75.98592, 93.50784, 91.872];
        const tps = [3.55, 6.98, 14.11, 20.94, 28.13, 44.13, 65.96, 81.17, 79.75];
        const throughputForLatency = [4.0896, 8.04096, 16.25472, 24.122880000000002, 32.40576, 50.83776, 75.98592, 93.50784];
        const concurrencyLabels = [1, 2, 4, 6, 8, 16, 32, 64];
        const peakTokensK = 93.50784;
        const peakConcurrency = 64;
        
        // Create scatter data for latency charts
        function makeScatterData(latencies) {
            return throughputForLatency.map((x, i) => ({ x: x, y: latencies[i] }));
        }
        
        // Lookup Chart - scatter plot with throughput on X-axis
        new Chart(document.getElementById('lookupChart'), {
            type: 'scatter',
            data: {
                datasets: [
                    {
                        label: 'p50',
                        data: makeScatterData([5.72, 5.43, 5.21, 5.06, 5.06, 5.0, 4.95, 5.56]),
                        borderColor: '#ff6b6b',
                        backgroundColor: 'rgba(255,107,107,0.5)',
                        showLine: true,
                        tension: 0.3,
                        pointRadius: 6
                    },
                    {
                        label: 'p90',
                        data: makeScatterData([8.76, 8.44, 8.02, 7.86, 7.66, 7.5, 6.69, 8.95]),
                        borderColor: '#ffa502',
                        backgroundColor: 'rgba(255,165,2,0.5)',
                        showLine: true,
                        tension: 0.3,
                        pointRadius: 6
                    },
                    {
                        label: 'p99',
                        data: makeScatterData([11.51, 11.14, 10.76, 11.21, 10.77, 12.81, 11.54, 21.0]),
                        borderColor: '#ff4757',
                        backgroundColor: 'rgba(255,71,87,0.5)',
                        showLine: true,
                        tension: 0.3,
                        pointRadius: 6
                    },
                    {
                        label: 'p100 (max)',
                        data: makeScatterData([64.5, 39.27, 43.61, 33.78, 38.16, 63.43, 101.35, 100.5]),
                        borderColor: '#8b0000',
                        backgroundColor: 'rgba(139,0,0,0.5)',
                        showLine: true,
                        tension: 0.3,
                        pointRadius: 6,
                        borderDash: [5, 5]
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    title: { display: true, text: 'Lookup Latency vs Token Throughput (Peak: ' + peakTokensK.toFixed(1) + 'K @ ' + peakConcurrency + 'c)', color: '#eee' },
                    legend: { labels: { color: '#eee' } },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const idx = context.dataIndex;
                                return context.dataset.label + ': ' + context.parsed.y.toFixed(2) + 'ms @ ' + context.parsed.x.toFixed(1) + 'K tokens/s (C=' + concurrencyLabels[idx] + ')';
                            }
                        }
                    }
                },
                scales: {
                    x: { 
                        title: { display: true, text: 'Token Throughput (K tokens/sec)', color: '#eee' },
                        ticks: { color: '#aaa' },
                        grid: { color: '#333' },
                        type: 'linear',
                        position: 'bottom'
                    },
                    y: { 
                        title: { display: true, text: 'Latency (ms)', color: '#eee' },
                        ticks: { color: '#aaa' },
                        grid: { color: '#333' },
                        beginAtZero: true
                    }
                }
            }
        });
        
        // Read Chart - scatter plot with throughput on X-axis
        new Chart(document.getElementById('readChart'), {
            type: 'scatter',
            data: {
                datasets: [
                    {
                        label: 'p50',
                        data: makeScatterData([19.67, 19.76, 20.22, 20.64, 20.85, 22.71, 27.13, 40.28]),
                        borderColor: '#4ecdc4',
                        backgroundColor: 'rgba(78,205,196,0.5)',
                        showLine: true,
                        tension: 0.3,
                        pointRadius: 6
                    },
                    {
                        label: 'p90',
                        data: makeScatterData([21.57, 21.95, 22.56, 23.21, 23.74, 27.84, 42.12, 77.29]),
                        borderColor: '#45b7d1',
                        backgroundColor: 'rgba(69,183,209,0.5)',
                        showLine: true,
                        tension: 0.3,
                        pointRadius: 6
                    },
                    {
                        label: 'p99',
                        data: makeScatterData([24.43, 24.77, 33.38, 36.25, 33.66, 55.52, 88.24, 138.14]),
                        borderColor: '#96ceb4',
                        backgroundColor: 'rgba(150,206,180,0.5)',
                        showLine: true,
                        tension: 0.3,
                        pointRadius: 6
                    },
                    {
                        label: 'p100 (max)',
                        data: makeScatterData([27.78, 33.03, 50.35, 63.64, 85.02, 124.12, 202.56, 205.24]),
                        borderColor: '#006400',
                        backgroundColor: 'rgba(0,100,0,0.5)',
                        showLine: true,
                        tension: 0.3,
                        pointRadius: 6,
                        borderDash: [5, 5]
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    title: { display: true, text: 'Read Latency vs Token Throughput (Peak: ' + peakTokensK.toFixed(1) + 'K @ ' + peakConcurrency + 'c)', color: '#eee' },
                    legend: { labels: { color: '#eee' } },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const idx = context.dataIndex;
                                return context.dataset.label + ': ' + context.parsed.y.toFixed(2) + 'ms @ ' + context.parsed.x.toFixed(1) + 'K tokens/s (C=' + concurrencyLabels[idx] + ')';
                            }
                        }
                    }
                },
                scales: {
                    x: { 
                        title: { display: true, text: 'Token Throughput (K tokens/sec)', color: '#eee' },
                        ticks: { color: '#aaa' },
                        grid: { color: '#333' },
                        type: 'linear',
                        position: 'bottom'
                    },
                    y: { 
                        title: { display: true, text: 'Latency (ms)', color: '#eee' },
                        ticks: { color: '#aaa' },
                        grid: { color: '#333' },
                        beginAtZero: true
                    }
                }
            }
        });
        
        // Throughput Chart  
        new Chart(document.getElementById('throughputChart'), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'TPS',
                        data: tps,
                        backgroundColor: 'rgba(255,230,109,0.7)',
                        borderColor: '#ffe66d',
                        borderWidth: 2,
                        yAxisID: 'y'
                    },
                    {
                        label: 'K Tokens/sec',
                        data: tokensK,
                        backgroundColor: 'rgba(0,212,255,0.7)',
                        borderColor: '#00d4ff',
                        borderWidth: 2,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    title: { display: true, text: 'Throughput by Concurrency', color: '#eee' },
                    legend: { labels: { color: '#eee' } }
                },
                scales: {
                    x: { 
                        title: { display: true, text: 'Total Concurrency', color: '#eee' },
                        ticks: { color: '#aaa' },
                        grid: { color: '#333' }
                    },
                    y: { 
                        type: 'linear',
                        position: 'left',
                        title: { display: true, text: 'TPS', color: '#ffe66d' },
                        ticks: { color: '#ffe66d' },
                        grid: { color: '#333' }
                    },
                    y1: {
                        type: 'linear',
                        position: 'right',
                        title: { display: true, text: 'K Tokens/sec', color: '#00d4ff' },
                        ticks: { color: '#00d4ff' },
                        grid: { drawOnChartArea: false }
                    }
                }
            }
        });
    </script>
</body>
</html>
